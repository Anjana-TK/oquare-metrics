name: 'OQuaRE metrics calculation module'
description: 'Calculates the metrics of ontology files in the given folder based on the metrics set by the OQuaRE framework'
inputs:
  ontology-folder:
    description: 'Folder which contains .owl files'
    required: true
    default: 'ontologies'
  contents-folder:
    description: 'Folder which will contain results and archives'
    default: 'OQuaRE'
  reasoner:
    description: 'Reasoner used by OQuaRE'
    required: true
    default: 'ELK'

runs: 
  using: 'composite'
  steps:
    - uses: actions/checkout@v2
    - uses: actions/setup-java@v2
      with:
        distribution: 'temurin'
        java-version: '8'
    - name: Setup folders
      run: |
        mkdir -p {{ inputs.contents-folder}} && mkdir -p {{ inputs.contents-folder}}/results && mkdir -p {{ inputs.contents-folder}}/archives \
        && mkdir -p {{ inputs.contents-folder}}/temp_results && mkdir {{ inputs.contents-folder}}/temp_results/metrics
      shell: bash
    - name: Call oquare library
      run: |
        find ./${{ inputs.ontology-folder}} -type f -maxdepth 1 -name "*.owl" \
        | while read file; do outputFile=$(basename "$file" .owl); outputFile="{{ inputs.contents-folder}}/temp_results/metrics/${outputFile}.xml"; \
        java -jar libs/oquare-versions.jar --ontology "$file" --reasoner "${{ inputs.reasoner }}" --outputFile "$outputFile"; \
        done
      shell: bash
    - name: Archive previous results
      run: |
        touch {{ inputs.contents-folder}}/results/temp_file \
        && mv -v {{ inputs.contents-folder}}/results/* {{ inputs.contents-folder}}/archives/ \
        && rm -f {{ inputs.contents-folder}}/archives/temp_file
      shell: bash
    - name: Move results to results folder and tag it with a date
      run: mv {{ inputs.contents-folder}}/temp_results {{ inputs.contents-folder}}/results/"$(date +%d-%m-%Y_%H-%M-%S)"
      shell: bash
    - name: Commit and push
      uses: EndBug/add-and-commit@v8